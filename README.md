# HYF. React 2. Week 1. Next.js.

Today:

Next.js specific staff, so let's start with questions about React.

## Types of rendering models

### Classic Web

- `index.html` parsed by browser step by step
- Routing by path on a server
- [Fun reading about how browsers work](https://gist.github.com/nishantmendiratta/db09531f80803465da36f0d43c3e58ac)

**What are minuses?**
1. 

**When is it fine?**
1. 

### CSR (Client Side Rendering)

- React becomes popular, and now we render pages with JavaScript on the client side
- `npm create vite@latest`
- `npm run build`
- `npm run preview`
- Not empty app doesn't have JSX parts inside the HTML
- Empty app still has JavaScript
- Client routing (requires additional libraries or manual handing)

>_Note_
>
>_We're using `build` + `preview`/`start` commands to see the result build we can see in production environment (after deploy)._
>
>_`npm run dev` is used to start a development server -- the results of the content there might be different in some cases from the production build,
which is not good for our demonstration._
> 
> **AGAIN: DEVELOPMENT SERVER WILL BEHAVE DIFFERENTLY**
> 
> Please, use development server when you develop things!
> 
> Please, use "production" server when you want to check how your app will behave in production!

**What are minuses?**
1. 

**When is it fine?**
1. 

### ~~SSG (Static Site Generation)~~ Static routes

- `npx create-next-app@latest`
- `npm run build`
- `npm run start`
- index.html is generated by the server and contains some jsx converted to html
- Routing by path on a server
- All pages are generated at build time (add `console.log` to see that)

**What are minuses?**
1.

**When is it fine?**
1. 

### ~~SSR (Server Side Rendering)~~ Dynamic routes

![img_1.png](img_1.png)

- (also Next.js)
- Pages are generated on the server at **request** time
- Next.js switches to Dynamic if dynamic routes are used:
  - cookies
  - headers
  - connection
  - searchParams prop

### ~~Client side rendering~~ Client Components

- `'use client'` clause
- Still has some HTML in the index.html
- Must be used with Client components:
  - hooks
  - events
  - DOM modifications
  - context (next time)
- You already know how to use it :)

### Routing

https://nextjs.org/docs/app/building-your-application/routing/defining-routes

- Folders in `app` define routes
- Routes without `page.js` inside doesn't work
- `page.js` must `export default` a React component
- `layout.js` -- shared part of the page for all nested routes
  - `app/layout.js` is required and called "Root Layout"
  - Doesn't rerender when client side navigation happens
  - Accepts `children` prop, that must be used
- Client side navigation
  - `useRouter` hook
- Server side navigation
  - `redirect` function
- Read current pathname
  - `usePathname` hook
- Dynamic routes
  - `[slug]` route
  - `useParams` hook
  - `params` prop
- Query parameters
  - `useSearchParams` hook
  - `searchParams` prop

### Server Components

- Goes to HTML
- Has limitations
  - no hooks
  - no events
  - no DOM modifications
  - no context
  - no state
  - can't be used inside Client components
    - = as a child of a Client component EXCEPT when you use `children` prop in a client component

## Example

- Request data in render function itself, no need for hooks
  - Create a path with data with a list of Cats
  - Use fetch to get data in a server component
  - Render list of Cats
- Usage of [slug] parameter in the path
  - Create a personal page for every Cat there
  - Add Links to the personal pages to the list of Cats
- Usage of searchParams prop (/search page)
  - Create a field to filter Cats by name
  - redirect every time the form is submitted (use `useSearchParams` hook)
  - Use searchParams prop to get the name from the form
- Usage of `children` prop: add a click counter
  - Use server component to render a Cat on [slug] page
  - Create Client component with button and a clicker
  - Use `children` prop to pass a Cat to the Client component
- Add the same setup for Dogs page
  - Create a layout with header to switch between Cats and Dogs

### Old APIs

- getStaticProps (for SSG)
- getServerSideProps (for SSR)

## Simple rules "Where to use what?"

1. Use client components only when you **have to**:
   1. When you need to handle user actions (onSubmit, onClick, etc.)
   1. When 3rd party libraries doesn't support server components
2. Put client components as deep as possible in the tree
3. Use `children` prop to pass server components to client components

## REFs in React

- Basically variable that saved between rerenders, but doesn't produce a rerender itself when changes
  - Example with useRef and useState hooks
- Manipulating DOM
  - Focus example
  - Other libraries (like D3.js) that require direct DOM manipulation

**Use cases?**
1. 

## Component Libraries

- Every project = new base components
- [Material UI](https://mui.com/material-ui/getting-started/)
- Sometimes produces errors with Server components (Autocomplete)
  - Fixable by using a Wrapper component

## Personal recommendation

[Next.js tutorial](https://nextjs.org/learn/dashboard-app)
